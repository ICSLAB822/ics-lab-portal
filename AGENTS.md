# Agents Guide (ics-lab-portal)

This repo is a static React + TypeScript site built with Vite and deployed to GitHub Pages.
Content is file-based (Markdown in `public/content`) and indexed at build time.

## Quick Orientation

- App entry: `index.tsx` -> `App.tsx`
- UI components: `components/`
- Hooks: `hooks/`
- Content/CMS loader: `utils/cms.ts`, `utils/markdown.ts`
- Content source: `public/content/**` (Markdown with YAML frontmatter)
- Static assets referenced by content: `public/files/**`
- Generated index: `public/content-index.json` (generated by `scripts/generate-index.js`)

## Commands (Build/Lint/Test)

Package manager is npm (lockfile: `package-lock.json`). Node 20 is used in CI.

### Install

- Install deps: `npm install`
- If install fails in CI-like environments, workflow uses: `npm install --legacy-peer-deps` (see `.github/workflows/deploy.yml`).

### Dev

- Start dev server: `npm run dev` (Vite)
- Preview production build: `npm run preview`

### Build / Typecheck

- Build (also generates content index): `npm run build`
  - Runs: `node scripts/generate-index.js` -> `tsc` -> `vite build` (see `package.json`).
- Typecheck only (no script provided): `npx tsc -p tsconfig.json`

### Common Workflows

- Regenerate content index only: `node scripts/generate-index.js`
- Clean, reproducible install (uses lockfile): `npm ci`

### Known Build Warnings

- `/index.css doesn't exist`: `index.html` links `/index.css`, but the file is missing. This is currently harmless (Tailwind comes from CDN), but Vite will warn.
- Large bundle warning (>500kB): non-fatal; consider code-splitting if performance becomes an issue.

### Deploy

- Local deploy helper: `npm run deploy` (uses `gh-pages -d dist`).
- CI deploy: GitHub Actions builds and uploads `dist/` (see `.github/workflows/deploy.yml`).

### Lint

- Not configured (no ESLint/Prettier/Biome config and no `lint` script).

### Tests

- Not configured (no `test` script; no Jest/Vitest/Playwright/Cypress config found).
- Running a single test: not available until a test runner is added.

## Repo-Specific Behavior (Do Not Fight It)

- Routing: `App.tsx` uses `HashRouter` for GitHub Pages. Avoid switching to `BrowserRouter` unless you also change hosting/rewrites.
- Vite base path: `vite.config.ts` sets `base: '/ics-lab-portal/'` for GitHub Pages.
- Styling: Tailwind is loaded via CDN in `index.html`. `index.html` also links `/index.css`, but that file does not exist (Vite emits a warning during build). If you need custom CSS, add a root-level `index.css` or remove/update the link.
- Content index: `scripts/generate-index.js` scans `public/content/**` and writes `public/content-index.json`.
  - It groups files by the first directory segment (news/projects/publications/people/gallery/pages).
  - If you introduce a new top-level content folder, update generator + `ContentIndex` type in `utils/cms.ts`.
- Runtime content loading: `utils/cms.ts` fetches `content-index.json` and then fetches each Markdown file.
  - Asset URLs are resolved into `public/files/<folder>/...` via `ASSETS_BASE`.

## Code Style Guidelines (Local Conventions)

There is no enforced formatter/linter. When editing:

- Keep diffs small; match the file's existing indentation and JSX formatting.
- Prefer single quotes for TS/JS strings and imports (existing code style).
- Use semicolons consistently (existing code style).

### Imports

- Order imports: React/stdlib -> third-party -> local modules.
- Use named imports where practical; keep import lists readable (wrap across lines when long).
- Use relative imports without extensions (e.g. `../utils/cms`).

### Naming

- Components/types/interfaces: PascalCase (e.g. `Navbar`, `NewsItem`).
- Variables/functions/hooks: camelCase (e.g. `useDynamicData`, `toggleTheme`).
- Constants: SCREAMING_SNAKE_CASE for config-ish values (e.g. `CACHE_KEY`).
- Files:
  - Components: `components/PascalCase.tsx`
  - Hooks: `hooks/useSomething.ts`
  - Utilities: `utils/*.ts`

### TypeScript

- `tsconfig.json` has `strict: true`.
- Prefer explicit prop interfaces for components (pattern: `interface XProps { ... }`).
- Avoid introducing new `any` / `as any` assertions.
  - Existing code uses `(import.meta as any).env` in a few places; do not expand this pattern.
  - Prefer `unknown` + narrowing/type guards when parsing dynamic data.

### React

- Components are function components; many are typed as `React.FC<...>`.
- Keep effects scoped and cleaned up (see `Navbar.tsx` scroll/keydown listeners).
- When adding a new route page, wrap it in `PageWrapper` (see `App.tsx`) to account for fixed navbar spacing.

### Error Handling / Logging

- Use `try/catch` around `fetch` / JSON parsing and return safe fallbacks (see `utils/cms.ts`, `hooks/useDynamicData.ts`).
- Prefer `console.warn` for recoverable issues and `console.error` for failures that break expected behavior.
- Avoid empty catch blocks; include context in logs (URL, id, etc.).

### Data / Content Conventions

- Domain types live in `types.ts`; prefer reusing/extending these instead of creating duplicate shapes.
- Content comes from Markdown + YAML frontmatter in `public/content/**` and is loaded at runtime.
- People bios: `utils/cms.ts` splits the Markdown body on a literal `---` to separate English/Chinese bios.
- i18n metadata pattern: frontmatter often uses `*_en` / `*_zh` fields (e.g. `name_en`, `name_zh`).

### Styling

- Styling is Tailwind utility classes (Tailwind is configured inline in `index.html`).
- Prefer editing/adding Tailwind classes over introducing new CSS files.

### Content Authoring (Markdown)

- Markdown frontmatter is parsed only if it starts at the top of the file and is wrapped in `---` blocks (see `utils/markdown.ts`).
- If an image is not provided in frontmatter, the first Markdown image in the body may be used as a fallback.

## Cursor / Copilot Rules

- No `.cursorrules`, `.cursor/rules/*`, or `.github/copilot-instructions.md` files were found in this repo.

## Local Agent Tooling Notes

- `.claude/settings.local.json` exists and allows running `node scripts/generate-index.js`.
- A TypeScript language server is not vendored here; if your agent workflow relies on LSP,
  install `typescript-language-server` globally or fall back to `npx tsc -p tsconfig.json`.

## Repo-Local Agent Skills

- Publication import SOP + prompt kit: `agent-skills/publication-import.md`
- Skills index: `agent-skills/README.md`
- Validate publication markdown/assets: `npm run validate:publications`
